## 参考

[2024电赛小白入门 手把手教你做一辆电赛小车|STM32|MSP432|PID|MPU6050_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1A1421671G/?spm_id_from=333.1245.0.0&vd_source=f129459aae6c6657e79d179b353113ae)

- 作者提供了自己的一套外设驱动库（ml）

## MSP432

MSP432过于贵了（一百多），stm32一块才10块

- MSP432的官方库和stm32的标准库不太一样，学习成本太大

- MSP432第一次打开，安装pack，不然会报错

### 文件架构

<img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20250313150720589.png" alt="image-20250313150720589" style="zoom:67%;" />

### ML库

up写的一套库，用于快速上手，省去了基层的各种细节，方便且适用性强，针对stm32和MSP432的代码差不多

```c
//main.c
#include "headfile.h"

int main(void)
{
	SysTick_Init();//系统滴答计时器，使用Delay()则需要保留
	OLED_Init();
	
	while (1)
	{

	} 
}

```

## 使用例程

```c
//流水灯
//ml_gpio.c.h
#include "headfile.h"

int main(void)
{
	//SysTick_Init();
	OLED_Init();
	1.流水灯
	gpio_init(GPIO_A,Pin_6,OUT_PP);
	
	
	while (1)
	{
		gpio_set(GPIO_A,Pin_6,1);
		delay_ms(500);
		gpio_set(GPIO_A,Pin_6,0);
		delay_ms(500);
	} 
}

```

```c
//按键控制LED亮灭
//ml_gpio.c.h
#include "headfile.h"

int main(void)
{
	//SysTick_Init();
	OLED_Init();

	gpio_init(GPIO_B,Pin_11,IU);
	gpio_init(GPIO_A,Pin_6,OUT_PP);
	gpio_set(GPIO_A,Pin_6,0);
	
	while (1)
	{
		if(gpio_get(GPIO_B,Pin_11) == 0){
			//除颤
			delay_ms(20);
			while(gpio_get(GPIO_B,Pin_11) == 0);
			delay_ms(20);
			
			uint8_t tmp = gpio_get(GPIO_A,Pin_6);
			gpio_set(GPIO_A,Pin_6,!tmp);
		}
	} 
}

```

```c
//控制OLED
//ml_oled.c.h
#include "headfile.h"

int main(void)
{
	//SysTick_Init();
	OLED_Init();
	OLED_ShowNum(1,1,100,3);

	
	while (1)
	{

	} 
}

```

```c
//TTL转UART模块
stm32，串口一，可使用printf(),TX-PA9，RX-PA10，GND-GND
//ml_uart.c.h
//main.c
#include "headfile.h"

int main(void)
{
	//SysTick_Init();
	OLED_Init();
	OLED_ShowNum(1,1,100,3);
	
	uart_init(UART_1,9600,0x00);
	
	int x = 0;
	while (1)
	{
		printf("test:%d\r\n",x);
		x++;
		delay_ms(1000);
	} 
}

//isr.c
//以下为串口中断服务函数
uint8_t rec_data;
void USART1_IRQHandler(void)
{
	if (USART1->SR&0x20)
	{
		rec_data = uart_getbyte(UART_1);
		uart_sendbyte(UART_1,rec_data);
		USART1->SR &= ~0x20;   //清除标志位
	}
}
```

```c
//ADC
//接上光敏电阻，AO接A1,VCC接5V，GND接GND
#include "headfile.h"

int main(void)
{
	//SysTick_Init();
	OLED_Init();
	OLED_ShowNum(1,1,100,3);
	
	uart_init(UART_1,9600,0x00);
	adc_init(ADC_1,ADC_Channel_1);
	
	int va;
	while (1)
	{
		va = adc_get(ADC_1,ADC_Channel_1);
		printf("test:%d\r\n",va);
		delay_ms(200);
	} 
}

```

```c
//定时器
//main.c
#include "headfile.h"

int main(void)
{
	//SysTick_Init();
	OLED_Init();
	OLED_ShowNum(1,1,100,3);
	
	tim_interrupt_ms_init(TIM_2,50,0);//每50ms进入一次中断函数
	gpio_init(GPIO_A,Pin_6,OUT_PP);
	
	while (1)
	{
		
	} 
}

//isr.c
//以下为定时器中断服务函数
int count = 0;
int state = 0;
void TIM2_IRQHandler(void)
{
	if(TIM2->SR&1)
	{
		count++;
		if(count == 20){
			gpio_set(GPIO_A,Pin_6,state);
			
			state++;
			state %= 2;
			
			count = 0;
		}
		TIM2->SR &= ~1; 
	}
}

```

## 电机驱动
硬件列表：轮趣科技的MG310电机，GMR编码器的更加准确；两轮差速小车；驱动板TB6612带稳压板

```c

```

